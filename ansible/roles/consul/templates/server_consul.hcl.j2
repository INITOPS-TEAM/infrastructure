node_name  = "consul-server"
server     = true
bootstrap_expect = 1
datacenter = "{{ consul_datacenter }}"
data_dir   = "{{ consul_data_dir }}"
bind_addr   = "{{ ansible_facts[private_interface]['ipv4']['address'] }}"
client_addr = "0.0.0.0"

ui_config {
  enabled = true
}

encrypt = "{{ consul_gossip_key }}"

acl {
  enabled                  = true # Enable ACL system. Only Consul server configs affect this value
  default_policy           = "deny" # Default policy for any request that doesn't match an ACL rule
  enable_token_persistence = true # Enable token persistence across server restarts

  tokens {
    initial_management = "{{ consul_acl_token }}" # Initial management (master) ACL token used to bootstrap the ACL system
    default            = "{{ consul_acl_token }}" # ACL token used for most of the ACL agent calls
  }
}

tls {
  defaults {
    ca_file   = "{{ consul_config_dir }}/certs/consul-agent-ca.pem"
    cert_file = "{{ consul_config_dir }}/certs/server.pem"
    key_file  = "{{ consul_config_dir }}/certs/server-key.pem"

    verify_incoming = true
    verify_outgoing = true
  }
}

ports {
  http  = -1
  https = 8501
  dns   = 8600
}

log_level = "INFO"